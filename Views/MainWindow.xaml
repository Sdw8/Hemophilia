<Window x:Class="Hemophilia.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:Hemophilia.ViewModels"
        xmlns:models="clr-namespace:Hemophilia.Models"
        Title="Гемофилия — Расчёт доз КФС"
        Icon="/bloodDrop.ico"
        Width="460"
        SizeToContent="Height"
        MaxHeight="780"
        ResizeMode="CanMinimize"
        WindowStartupLocation="CenterScreen"
        Background="#0D1117">

    <Window.Resources>
        <SolidColorBrush x:Key="BgDark"    Color="#0D1117"/>
        <SolidColorBrush x:Key="BgCard"    Color="#161B22"/>
        <SolidColorBrush x:Key="Accent"    Color="#2D7DD2"/>
        <SolidColorBrush x:Key="TextPri"   Color="#E6EDF3"/>
        <SolidColorBrush x:Key="TextMuted" Color="#8B949E"/>
        <SolidColorBrush x:Key="BorderCol" Color="#30363D"/>

        <Style x:Key="SectionLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#8B949E"/>
            <Setter Property="FontSize"   Value="10"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin"     Value="0,0,0,7"/>
        </Style>

        <!-- Compact card — reduced padding to save vertical space -->
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="Background"      Value="#161B22"/>
            <Setter Property="CornerRadius"    Value="8"/>
            <Setter Property="Padding"         Value="14,12"/>
            <Setter Property="Margin"          Value="0,0,0,7"/>
            <Setter Property="BorderBrush"     Value="#30363D"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <!-- Pills: height 30 (was 34) -->
        <Style x:Key="PillRadio" TargetType="RadioButton">
            <Setter Property="Foreground"      Value="#8B949E"/>
            <Setter Property="Background"      Value="#0D1117"/>
            <Setter Property="BorderBrush"     Value="#30363D"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Height"          Value="30"/>
            <Setter Property="Cursor"          Value="Hand"/>
            <Setter Property="FontSize"        Value="12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6" Padding="10,0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Background"  Value="#1C3A5C"/>
                                <Setter Property="BorderBrush" Value="#2D7DD2"/>
                                <Setter Property="Foreground"  Value="#58A6FF"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="#2D7DD2"/>
                                <Setter Property="Foreground"  Value="#CDD9E5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Compact input: smaller padding and font (was Padding=10,8 FontSize=14) -->
        <Style x:Key="InputBox" TargetType="TextBox">
            <Setter Property="Background"      Value="#0D1117"/>
            <Setter Property="Foreground"      Value="#E6EDF3"/>
            <Setter Property="BorderBrush"     Value="#30363D"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding"         Value="8,4"/>
            <Setter Property="FontSize"        Value="12"/>
            <Setter Property="CaretBrush"      Value="#58A6FF"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6">
                            <ScrollViewer x:Name="PART_ContentHost" Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="#2D7DD2"/>
                            </Trigger>
                            <Trigger Property="Validation.HasError" Value="True">
                                <Setter Property="BorderBrush" Value="#F85149"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SimpleCheck" TargetType="CheckBox">
            <Setter Property="Foreground" Value="#8B949E"/>
            <Setter Property="FontSize"   Value="12"/>
            <Setter Property="Cursor"     Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <StackPanel Orientation="Horizontal">
                            <Border x:Name="box" Width="15" Height="15" CornerRadius="4"
                                    Background="#0D1117" BorderBrush="#30363D"
                                    BorderThickness="1" Margin="0,0,7,0">
                                <Path x:Name="tick" Data="M2,7 L6,11 L13,3"
                                      Stroke="#58A6FF" StrokeThickness="1.8"
                                      StrokeStartLineCap="Round" StrokeEndLineCap="Round"
                                      Visibility="Hidden"/>
                            </Border>
                            <ContentPresenter VerticalAlignment="Center"/>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="tick" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="box"  Property="BorderBrush" Value="#2D7DD2"/>
                                <Setter Property="Foreground" Value="#CDD9E5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PrimaryBtn" TargetType="Button">
            <Setter Property="Background"      Value="#2D7DD2"/>
            <Setter Property="Foreground"      Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding"         Value="26,10"/>
            <Setter Property="FontSize"        Value="12"/>
            <Setter Property="FontWeight"      Value="SemiBold"/>
            <Setter Property="Cursor"          Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="7" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#58A6FF"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#21262D"/>
                                <Setter Property="Foreground" Value="#484F58"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="FieldLbl" TargetType="TextBlock">
            <Setter Property="Foreground"   Value="#8B949E"/>
            <Setter Property="FontSize"     Value="10"/>
            <Setter Property="FontWeight"   Value="SemiBold"/>
            <Setter Property="Margin"       Value="0,0,0,5"/>
            <Setter Property="TextWrapping" Value="NoWrap"/>
        </Style>
    </Window.Resources>

    <!-- No ScrollViewer needed — window sizes to fit content (SizeToContent=Height) -->
    <StackPanel Margin="20,18,20,18">

        <!-- Header — compact -->
        <StackPanel Margin="0,0,0,14">
            <TextBlock Text="РАСЧЁТ ДОЗ КФС" FontSize="10" FontWeight="SemiBold"
                       Foreground="#2D7DD2" Margin="0,0,0,3"/>
            <TextBlock Text="Гемофилия A и B" FontSize="22" FontWeight="Bold"
                       Foreground="#E6EDF3"/>
            <TextBlock Foreground="#8B949E" FontSize="11" Margin="0,3,0,0"
                       Text="По данным Руководства ВФГ, 3-е издание — Таблица 7-2"/>
        </StackPanel>

        <!-- 1. Тип гемофилии -->
        <Border Style="{StaticResource Card}">
            <StackPanel>
                <TextBlock Text="ТИП ГЕМОФИЛИИ" Style="{StaticResource SectionLabel}"/>
                <WrapPanel>
                    <RadioButton Style="{StaticResource PillRadio}" Content="Гемофилия A (FVIII)"
                        IsChecked="{Binding HemophiliaType, Converter={StaticResource EnumToBool},
                                    ConverterParameter={x:Static models:HemophiliaType.TypeA}}"/>
                    <RadioButton Style="{StaticResource PillRadio}" Content="Гемофилия B (FIX)"
                        IsChecked="{Binding HemophiliaType, Converter={StaticResource EnumToBool},
                                    ConverterParameter={x:Static models:HemophiliaType.TypeB}}"/>
                </WrapPanel>
                <CheckBox Style="{StaticResource SimpleCheck}" Margin="0,9,0,0"
                          Content="Ребёнок младше 15 лет  (rFIX: коэффициент 0,7 вместо 0,8)"
                          IsChecked="{Binding IsUnder15}"
                          Visibility="{Binding IsTypeBSelected, Converter={StaticResource BoolToVis}}"/>
            </StackPanel>
        </Border>

        <!-- 2. Протокол дозирования -->
        <Border Style="{StaticResource Card}">
            <StackPanel>
                <TextBlock Text="ПРОТОКОЛ ДОЗИРОВАНИЯ" Style="{StaticResource SectionLabel}"/>
                <WrapPanel>
                    <RadioButton Style="{StaticResource PillRadio}"
                        Content="Низкодозный (ресурсные ограничения)"
                        IsChecked="{Binding DoseProtocol, Converter={StaticResource EnumToBool},
                                    ConverterParameter={x:Static models:DoseProtocol.LowDose}}"/>
                    <RadioButton Style="{StaticResource PillRadio}"
                        Content="Высокодозный (без ограничений)"
                        IsChecked="{Binding DoseProtocol, Converter={StaticResource EnumToBool},
                                    ConverterParameter={x:Static models:DoseProtocol.HighDose}}"/>
                </WrapPanel>
                <TextBlock Text="{Binding DoseProtocolDescription}" Foreground="#8B949E"
                           FontSize="11" Margin="0,7,0,0"/>
            </StackPanel>
        </Border>

        <!-- 3. Данные пациента — Grid rows keep inputs at same level regardless of label height -->
        <Border Style="{StaticResource Card}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="14"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" Grid.Column="0" Text="ВЕС (КГ)"
                           Style="{StaticResource FieldLbl}"/>
                <TextBlock Grid.Row="0" Grid.Column="2" Text="ИСХОДНЫЙ УРОВЕНЬ ФАКТОРА (%)"
                           Style="{StaticResource FieldLbl}"/>
                <TextBox Grid.Row="1" Grid.Column="0" Style="{StaticResource InputBox}"
                         Text="{Binding WeightText, UpdateSourceTrigger=PropertyChanged,
                                ValidatesOnDataErrors=True}"/>
                <TextBox Grid.Row="1" Grid.Column="2" Style="{StaticResource InputBox}"
                         Text="{Binding CurrentLevelText, UpdateSourceTrigger=PropertyChanged,
                                ValidatesOnDataErrors=True}"/>
            </Grid>
        </Border>

        <!-- 4. Тип кровотечения — UniformGrid 2×5, all cells equal height -->
        <Border Style="{StaticResource Card}">
            <StackPanel>
                <TextBlock Text="ТИП КРОВОТЕЧЕНИЯ / ВМЕШАТЕЛЬСТВА" Style="{StaticResource SectionLabel}"/>
                <UniformGrid Columns="2" Rows="5">
                    <RadioButton Style="{StaticResource PillRadio}" Content="Внутрисуставное"
                        Margin="0,0,3,4"
                        IsChecked="{Binding BleedingType, Converter={StaticResource EnumToBool},
                                    ConverterParameter={x:Static models:BleedingType.Joint}}"/>
                    <RadioButton Style="{StaticResource PillRadio}" Content="Мышечное (поверхностное)"
                        Margin="3,0,0,4"
                        IsChecked="{Binding BleedingType, Converter={StaticResource EnumToBool},
                                    ConverterParameter={x:Static models:BleedingType.ShallowMuscle}}"/>
                    <RadioButton Style="{StaticResource PillRadio}" Content="Мышечное (глубокое)"
                        Margin="0,0,3,4"
                        IsChecked="{Binding BleedingType, Converter={StaticResource EnumToBool},
                                    ConverterParameter={x:Static models:BleedingType.IliopsoasDeepMuscle}}"/>
                    <RadioButton Style="{StaticResource PillRadio}" Content="Внутричерепное (ЦНС)"
                        Margin="3,0,0,4"
                        IsChecked="{Binding BleedingType, Converter={StaticResource EnumToBool},
                                    ConverterParameter={x:Static models:BleedingType.Intracranial}}"/>
                    <RadioButton Style="{StaticResource PillRadio}" Content="Горло и шея"
                        Margin="0,0,3,4"
                        IsChecked="{Binding BleedingType, Converter={StaticResource EnumToBool},
                                    ConverterParameter={x:Static models:BleedingType.ThroatNeck}}"/>
                    <RadioButton Style="{StaticResource PillRadio}" Content="Желудочно-кишечное"
                        Margin="3,0,0,4"
                        IsChecked="{Binding BleedingType, Converter={StaticResource EnumToBool},
                                    ConverterParameter={x:Static models:BleedingType.Gastrointestinal}}"/>
                    <RadioButton Style="{StaticResource PillRadio}" Content="Почечное"
                        Margin="0,0,3,4"
                        IsChecked="{Binding BleedingType, Converter={StaticResource EnumToBool},
                                    ConverterParameter={x:Static models:BleedingType.Renal}}"/>
                    <RadioButton Style="{StaticResource PillRadio}" Content="Глубокие резаные раны"
                        Margin="3,0,0,4"
                        IsChecked="{Binding BleedingType, Converter={StaticResource EnumToBool},
                                    ConverterParameter={x:Static models:BleedingType.DeepLaceration}}"/>
                    <RadioButton Style="{StaticResource PillRadio}" Content="Операция (большая)"
                        Margin="0,0,3,0"
                        IsChecked="{Binding BleedingType, Converter={StaticResource EnumToBool},
                                    ConverterParameter={x:Static models:BleedingType.SurgeryMajor}}"/>
                    <RadioButton Style="{StaticResource PillRadio}" Content="Операция (малая)"
                        Margin="3,0,0,0"
                        IsChecked="{Binding BleedingType, Converter={StaticResource EnumToBool},
                                    ConverterParameter={x:Static models:BleedingType.SurgeryMinor}}"/>
                </UniformGrid>
            </StackPanel>
        </Border>

        <!-- Formula hint -->
        <Border Background="#161B22" CornerRadius="7" Padding="12,8"
                BorderBrush="#21262D" BorderThickness="1" Margin="0,0,0,8">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Формула: " Foreground="#484F58" FontSize="11"/>
                <TextBlock Text="{Binding FormulaHint}" Foreground="#8B949E" FontSize="11"
                           TextWrapping="Wrap"/>
            </StackPanel>
        </Border>

        <!-- Calculate -->
        <Button Style="{StaticResource PrimaryBtn}"
                Content="Рассчитать дозу"
                Command="{Binding CalculateCommand}"
                HorizontalAlignment="Right"/>

    </StackPanel>
</Window>
